<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Конференция</title>
    <link rel="icon" href="./../assets/media/images/generals/favicon.ico">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">
    <link rel="stylesheet" href="./../assets/css/styles.css">
</head>
<body>
    <!-- /Header start -->
    <header>
        <div class="container">
            <div class="row">
                <div class="col-sm-3 logo ps-4 pt-2 text-center text-sm-start">
                    <img src="./../assets/media/images/generals/logo.png" alt="Logo">
                </div>
                <div class="col-sm-9">
                    <h1 class="d-none">Конференция Аль-Хорезми</h1>
                    <p class="entry p-4">IX-Международная научная конференция «Актуальные проблемы прикладной математики и информационных технологий – Аль-Хорезми 2024» 22-23 октябрь. Ташкент.</p>
                </div>
                <div class="d-flex justify-content-evenly d-md-block position-relative">
                    <div class="sign-in d-inline-block">
                        <a class="btn" href="./auth/login" id="header-sign-in">Вход</a>
                    </div>
                    <div class="language-menu d-inline-block">
                        <div class="dropdown">
                            <button class="btn dropdown-toggle" role="button" data-bs-toggle="dropdown" aria-expanded="false">RU</button>
                            <ul class="dropdown-menu">
                                <li><button class="dropdown-item language" id="uz">UZ</button></li>
                                <li><button class="dropdown-item language" id="en">EN</button></li>
                            </ul>
                        </div>
                    </div>
                    <div class="custom-menu d-inline-block d-md-none">
                        <div class="custom-dropdown">
                            <button class="btn custom-dropdown-toggle">
                                <span class="text-truncate">Участники</span>
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-caret-down-fill" viewBox="0 0 16 16">
                                    <path d="M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z"/>
                                </svg>
                            </button>
                            <ul class="custom-dropdown-menu position-absolute list-unstyled d-none">
                                <li><a href="./index" class="custom-dropdown-item px-2 py-1 d-block">Главная</a></li>
                                <li><a href="./organizers" class="custom-dropdown-item px-2 py-1 d-block">Организаторы</a></li>
                                <li><a href="./speakers" class="custom-dropdown-item px-2 py-1 d-block">Приглашенные Спикеры</a></li>
                                <li><a href="./participants" class="custom-dropdown-item px-2 py-1 d-block">Участники</a></li>
                                <li><a href="./important-dates" class="custom-dropdown-item px-2 py-1 d-block">Важные даты</a></li>
                                <li><a href="./auth/registr" class="custom-dropdown-item px-2 py-1 d-block">Регистрация</a></li>
                                <li><a href="./sections" class="custom-dropdown-item px-2 py-1 d-block">Разделы</a></li>
                                <li><a href="./submission" class="custom-dropdown-item px-2 py-1 d-block">Правила оформления</a></li>
                                <li><a href="./conference-venue" class="custom-dropdown-item px-2 py-1 d-block">Место проведения</a></li>
                                <li><a href="./accommodation" class="custom-dropdown-item px-2 py-1 d-block">Размещение</a></li>
                                <li><a href="./social-program" class="custom-dropdown-item px-2 py-1 d-block">Социальная программа</a></li>
                                <li><a href="./conference-fees" class="custom-dropdown-item px-2 py-1 d-block">Сборы за конференцию</a></li>
                                <li><a href="./program" class="custom-dropdown-item px-2 py-1 d-block">Программа</a></li>
                                <li><a href="./sponsors" class="custom-dropdown-item px-2 py-1 d-block">Спонсоры</a></li>
                                <li><a href="./contacts" class="custom-dropdown-item px-2 py-1 d-block">Контакты</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>
    <!-- /Header end -->
    
    <main>
        <div class="container p-0">
            <!-- Navbar start -->
            <nav class="navbar navbar-expand d-none d-md-flex">
                <div class="container-fluid">
                    <div class="collapse navbar-collapse justify-content-center" id="navbarNavDropdown">
                        <ul class="navbar-nav">
                            <li class="nav-item">
                                <a class="nav-link" href="./index">Главная</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="./organizers">Организаторы</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="./speakers">Приглашенные Спикеры</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="./participants">Участники</a>
                            </li>
                        </ul>
                    </div>
                </div>
            </nav>
            <!-- /Navbar end -->

            <div class="row mt-3 mx-0">
                <div class="col-md-4 d-none d-md-block ps-lg-0">
                    <menu class="m-0 p-0">
                        <div class="list-group rounded-0">
                            <a href="./important-dates" class="list-group-item list-group-item-action bordered">Важные даты</a>
                            <a href="./auth/registr" class="list-group-item list-group-item-action bordered">Регистрация</a>
                            <a href="./sections" class="list-group-item list-group-item-action bordered">Разделы</a>
                            <a href="./submission" class="list-group-item list-group-item-action bordered">Правила оформления</a>
                            <a href="./conference-venue" class="list-group-item list-group-item-action bordered">Место проведения</a>
                            <a href="./accommodation" class="list-group-item list-group-item-action bordered">Размещение</a>
                            <a href="./social-program" class="list-group-item list-group-item-action bordered">Социальная программа</a>
                            <a href="./conference-fees" class="list-group-item list-group-item-action bordered">Сборы за конференцию</a>
                            <a href="./program" class="list-group-item list-group-item-action bordered">Программа</a>
                            <a href="./sponsors" class="list-group-item list-group-item-action bordered">Спонсоры</a>
                            <a href="./contacts" class="list-group-item list-group-item-action bordered">Контакты</a>
                        </div>
                    </menu>
                </div>

                <div class="col-md-8">
                    <aside class="participants custom-black-text">
                        <h2 class="page-heading fw-bold custom-black-text fs-3 mb-4">Участники</h2>

                        <div id="userList"></div>
                        <nav class="mt-3 mw-100" aria-label="Page navigation">
                            <ul class="pagination mw-100">
                            </ul>
                        </nav>
                    </aside>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer start -->
    <footer class="footer py-4 mt-3">
        <div class="container">
            <p class="m-0 ps-3">IX-Международная научная конференция «Актуальные проблемы прикладной <br>  математики и информационных технологий – Аль-Хорезми 2024»</p>
        </div>
    </footer>
    <!-- /Footer end -->

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js" integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q" crossorigin="anonymous"></script>
    <script src="./../assets/js/uz-ru-scripts.js"></script>
    <script src="./../assets/js/main.js"></script>
    <script>
        let currentPage = 1;
        const usersPerPage = 25;
        let users = [];

        async function fetchUsers() {
            try {
                const response = await fetch('http://127.0.0.1:8000/api/users/');
                if (!response.ok) throw new Error('Server error');
                const data = await response.json();
                users = data;
                renderUsers();
                renderPagination();
            } catch (error) {
                document.getElementById('userList').innerText = 'Произошла ошибка при загрузке списка пользователей. Пожалуйста, попробуйте позже.';
                console.error(error);
            }
        }
        function renderUsers() {
            const userList = document.getElementById('userList');
            userList.innerHTML = '';

            const start = (currentPage - 1) * usersPerPage;
            const end = start + usersPerPage;
            const paginatedUsers = users.slice(start, end);
            let order = start + 1;
            paginatedUsers.forEach(user => {
                const fullName = `${order}. ${user.last_name} ${user.first_name}`;
                const div = document.createElement("div");
                div.textContent = fullName;
                userList.appendChild(div);
                order++;
            });
        }
        function renderPagination() {
            const pagination = document.getElementsByClassName('pagination')[0];
            pagination.innerHTML = '';

            const pageCount = Math.ceil(users.length / usersPerPage);
            const maxVisiblePages = window.innerWidth > 991.9 ? 5 : 1;
            const half = Math.floor(maxVisiblePages / 2);

            const startPage = Math.max(1, currentPage - half);
            const endPage = Math.min(pageCount, currentPage + half);

            const addPageItem = (text, page = null, active = false, disabled = false) => {
                const li = document.createElement('li');
                li.className = 'page-item';
                if (active) li.classList.add('active');
                if (disabled) li.classList.add('disabled');

                const a = document.createElement('a');
                a.className = 'page-link';
                a.href = '#';
                a.textContent = text;

                if (page !== null && !disabled) {
                    a.onclick = (e) => {
                        e.preventDefault();
                        currentPage = page;
                        renderUsers();
                        renderPagination();
                    };
                }

                li.appendChild(a);
                pagination.appendChild(li);
            };

            addPageItem('«', currentPage - 1, false, currentPage === 1);

            if (startPage > 1) {
                addPageItem('1', 1);
                if (startPage > 2) {
                    addPageItem('...', null, false, true);
                }
            }

            for (let i = startPage; i <= endPage; i++) {
                addPageItem(i, i, i === currentPage);
            }

            if (endPage < pageCount) {
                if (endPage < pageCount - 1) {
                    addPageItem('...', null, false, true);
                }
                addPageItem(pageCount, pageCount);
            }

            addPageItem('»', currentPage + 1, false, currentPage === pageCount);
        }

        fetchUsers();
    </script>
</body>
</html>